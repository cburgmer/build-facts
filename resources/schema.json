{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://github.com/cburgmer/build-facts/schema.json",
  "type": "object",
  "title": "Build Data",
  "description": "Build data as generated by the sync actions",
  "required": ["jobName", "buildId", "start"],
  "properties": {
    "jobName": {
      "type": "string",
      "description": "Name of the build job"
    },
    "buildId": {
      "type": "string",
      "description": "Id of the build (an instance of the build job being run)"
    },
    "start": {
      "type": "integer",
      "minimum": 0,
      "description": "Start timestamp of the build (Unix epoch in milliseconds)",
      "examples": [1451449853542]
    },
    "end": {
      "type": "integer",
      "minimum": 0,
      "description": "End timestamp of the build (Unix epoch in milliseconds). If the duration of a build cannot be deduced the build's end can be omitted.",
      "examples": [1451449870555]
    },
    "outcome": {
      "type": "string",
      "enum": ["pass", "fail"],
      "description": "Outcome of the build"
    },
    "inputs": {
      "type": "array",
      "description": "Inputs with which the build was executed. The assumption is that given the same inputs, two builds should yield the same outputs.",
      "examples": [
        [
          {
            "revision": "1eadcdd4d35f9a",
            "sourceId": "git@github.com:cburgmer/buildviz.git"
          }
        ]
      ],
      "items": {
        "type": "object",
        "required": ["sourceId", "revision"],
        "properties": {
          "sourceId": {
            "type": "string",
            "description": "Stable identifier of the input"
          },
          "revision": {
            "type": "string",
            "description": "Actual value of the input"
          }
        },
        "additionalProperties": false
      }
    },
    "triggeredBy": {
      "type": "array",
      "description": "References to other builds that triggered the execution of this build. This is intended to capture automatic triggers of downstream builds to calculate overall runtime, and should exclude instances where human intervention was required, which adds delay.",
      "examples": [
        [
          {
            "jobName": "Test",
            "buildId": "42"
          }
        ]
      ],
      "items": {
        "type": "object",
        "required": ["jobName", "buildId"],
        "properties": {
          "jobName": {
            "type": "string",
            "description": "Name of the build job"
          },
          "buildId": {
            "type": "string",
            "description": "Id of the build (an instance of the build job being run)"
          }
        },
        "additionalProperties": false
      }
    },
    "testResults": {
      "type": "array",
      "description": "Results of a test run inside the build",
      "examples": [
        [
          {
            "name": "Test Suite",
            "children": [
              {
                "classname": "some.class",
                "name": "A Test",
                "runtime": 2,
                "status": "pass"
              }
            ]
          }
        ]
      ],
      "items": {
        "type": "object",
        "required": ["name", "children"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Grouping name of a set of test results, e.g. a test suite name"
          },
          "children": {
            "type": "array",
            "description": "Set of test results",
            "items": {
              "type": "object",
              "required": ["classname", "name", "status"],
              "properties": {
                "classname": {
                  "type": "string",
                  "description": "Typically a reference to a source code file or class name"
                },
                "name": {
                  "type": "string",
                  "description": "Name of the test"
                },
                "runtime": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Elapsed time of the test in milliseconds"
                },
                "status": {
                  "type": "string",
                  "enum": ["pass", "fail", "skipped", "error"],
                  "description": "Outcome of the test"
                }
              },
              "additionalProperties": false
            }
          }
        },
        "additionalProperties": false
      }
    },
    "tasks": {
      "type": "array",
      "description": "Information on tasks run within the job",
      "examples": [
        [
          {
            "name": "deploy",
            "start": 1451449853500,
            "end": 1451449853602,
            "worker": "worker-456789"
          },
          {
            "name": "smoke-test",
            "start": 1451449853710,
            "end": 1451449853799,
            "worker": "worker-34598"
          }
        ]

      ],
      "items": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Unique name of the task"
          },
          "start": {
            "type": "integer",
            "minimum": 0,
            "description": "Start timestamp of the task (Unix epoch in milliseconds)",
            "examples": [1451449853542]
          },
          "end": {
            "type": "integer",
            "minimum": 0,
            "description": "End timestamp of the task (Unix epoch in milliseconds).",
            "examples": [1451449870555]
          },
          "worker": {
            "type": "string",
            "description": "Name of the worker executing the task"
          }
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
